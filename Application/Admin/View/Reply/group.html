<extend name="Public/base"/>
<block name="style">
	<css href="__STATIC__/face/css/face.css" />
</block>
<block name="body">
	<div>
		<div class="page-head">
			<h2>消息</h2>
		</div>
		<div class="cl-mcont">
			<div class="row">
				<div class="col-md-12">
					<div class="block-flat">
						<div class="header">
							<h3 class="hthin">{$meta_title}</h3>
						</div>
						<div class="content">
							<ul class="nav nav-tabs">
								<li class="active"><a href="{:U('Reply/group')}">消息群发</a></li>
								<li><a href="{:U('Reply/record')}">已发送消息</a></li>
							</ul>
							<form action="{:U('')}" class="form-horizontal" method="post">
								<div class="tab-content no-padding">
									<div class="chat-wi">
										<div class="chat-tools">
											<ul class="nav nav-tabs">
												<li class="active"><label class="control-label">群发对象</label></li>
												<li>
													<div><select class="form-control" name="is_to_all" id="is_to_all">
															<option value="true">全部用户</option>
															<option value="false">分组发送</option>
														  </select>	</div>
												</li>
												<li>
													<div><select class="form-control" name="group_id" id="group_id" style="display:none">
															<volist name="group" id="item">
															<option value="{$item['id']}">{$item['name']} ({$item['count']})</option>
															</volist>
														  </select>	</div>
												</li>
											</ul>
										</div>
										<div class="chat-tools">
											<ul class="nav nav-tabs">
												<li class="active">
													<div data-target="#appmsgArea" data-toggle="tab" data-msgtype="mpnews"><i class="fa fa-list-alt"></i>图文</div>
												</li>
												<li>
													<div data-target="#textArea" data-toggle="tab" data-msgtype="text"><i class="fa fa-pencil"></i>文字</div>
												</li>
												<li>
													<div data-target="#imageArea" data-toggle="tab" data-msgtype="image"><i class="fa fa-picture-o"></i>图片</div>
												</li>
												<li>
													<div data-target="#audioArea" data-toggle="tab" data-msgtype="voice"><i class="fa fa-microphone"></i>语音</div>
												</li>
												<li>
													<div data-target="#videoArea" data-toggle="tab" data-msgtype="mpvideo"><i class="fa fa-video-camera"></i>视频</div>
												</li>
											</ul>
										</div>
									</div>
									<div class="tab-pane" id="textArea">
										<div class="layui-form">
											<textarea name="content" id="LAY_desc"></textarea>
										</div>
									</div>
									<div class="tab-pane active" id="appmsgArea">
										<div class="cl-mcont white height188">
											<div class="gallery-cont">
												<notempty name="Think.get.media_id">
												<div class="col-md-6 spacer-bottom-sm item w2">
												<div class="container-fluid wxls white-box">
												<div class="head imghg">
													<span class="pull-right">
														<i class="fa fa-trash-o fa-lg color imgdel"></i>
													</span>
												</div>
												<div class="img container-fluid no-padding">
												<volist name="news" id="item">
												<eq name="i" value="1">
												<div class="tw">
													<div class="wxtitle">{$item['title']}</div>
													<img src="{$item['thumb_media_id']|getImgMedia}" class="img-responsive">
												</div>
												<else/>
												<div class="wxdtw">
													<div class="wxtwtitle">
														<h5>{$item['title']}</h5></div>
														<div class="wxtwimg">
														<img src="{$item['thumb_media_id']|getImgMedia}" class="img-responsive">
													</div>
												</div>
												</eq>
												</volist>
												</div>
												</div>
												</div>
												</notempty>
											</div>
										</div>
										<div class="edit-up col-lg-12 upnews">
											<ul class="nav nav-pills">
												<li class="active opiframe" url="{:U('Material/iframe',array('type'=>'news'))}"><i class="fa fa-cloud"></i>从素材库中选择</li>
												<li class="addmsg" data-url="{:U('Material/addmsg')}"><i class="fa fa-plus"></i>新建图文消息</li>
											</ul>
										</div>
									</div>
									<div class="tab-pane" id="imageArea">
										<div class="cl-mcont white height188">
											<div class="gallery-cont"></div>
										</div>
										<div class="edit-up col-lg-12 upimage">
											<ul class="nav nav-pills">
												<li class="active opiframe" url="{:U('Material/iframe',array('type'=>'image','show'=>1))}"><i class="fa fa-cloud"></i>从素材库中选择</li>
												<li><input type="file" id="upload_img"></li>
											</ul>
										</div>
									</div>
									<div class="tab-pane" id="audioArea">
										<div class="cl-mcont white height188">
											<div class="gallery-cont"></div>
										</div>
										<div class="edit-up col-lg-12 upaudio">
											<ul class="nav nav-pills">
												<li class="active opiframe" url="{:U('Material/iframe',array('type'=>'voice'))}"><i class="fa fa-cloud"></i>从素材库中选择</li>
												<li><input type="file" id="upload_audio"></li>
											</ul>
										</div>
									</div>
									<div class="tab-pane" id="videoArea">
										<div class="cl-mcont white height188">
											<div class="gallery-cont"></div>
										</div>
										<div class="edit-up col-lg-12 upvideo">
											<ul class="nav nav-pills">
												<li class="active opiframe" url="{:U('Material/iframe',array('type'=>'video'))}"><i class="fa fa-cloud"></i>从素材库中选择</li>
												<li><input type="file" id="upload_video"></li>
											</ul>
										</div>
									</div>
									<input type="hidden" name="msgtype" id="msgtype" value="mpnews">
									<input type="hidden" name="media_id" id="media_id" value="{$Think.get.media_id|default=""}">
									<div class="form-group no-margin-y">
										<div class="col-sm-offset-2 col-sm-10 spacer-xs">
											<button class="btn btn-primary" type="submit" target-form="form-horizontal">发 送</button>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</block>
<block name="script">
	<js href="__STATIC__/face/face_icon.js" />
	<js href="__STATIC__/face/face.js" />
	<js href="__STATIC__/uploadify/jquery.uploadify.min.js" />
	<js href="__JS__/behaviour/weixin.js" />
	<script type="text/javascript">
	$(document).ready(function(){
		$("#upload_img").uploadify({
			"height"          : 20,
			"swf"             : "__STATIC__/uploadify/uploadify.swf",
			"fileObjName"     : "download",
			"buttonClass"     : "fa fa-cloud-upload no-padding",
			"buttonText"      : "上传图片",
			"uploader"        : "{:U('Material/uploadweixin',array('type'=>'image','session_id'=>session_id()))}",
			"width"           : 100,
			'removeTimeout'	  : 1,
			'fileTypeExts'	  : '*.jpg; *.png; *.gif; *.jpeg;',
			"onUploadSuccess" : uploadPicture,
			'onFallback' : function() {
				alert('未检测到兼容版本的Flash.');
			}
		});
		$("#upload_audio").uploadify({
		"height"          : 20,
		"swf"             : "__STATIC__/uploadify/uploadify.swf",
		"fileObjName"     : "download",
		"buttonClass"     : "fa fa-cloud-upload no-padding",
		"buttonText"      : "上传语音",
		"uploader"        : "{:U('Material/uploadweixin',array('type'=>'audio','session_id'=>session_id()))}",
		"width"           : 100,
		'removeTimeout'	  : 1,
		'fileTypeExts'	  : '*.arm; *.mp3;*.wma; *.wav; *.amr;',
		"onUploadSuccess" : uploadPicture,
		'onFallback' : function() {
			alert('未检测到兼容版本的Flash.');
		}
	});
	$("#upload_video").uploadify({
		"height"          : 20,
		"swf"             : "__STATIC__/uploadify/uploadify.swf",
		"fileObjName"     : "download",
		"buttonClass"     : "fa fa-cloud-upload no-padding",
		"buttonText"      : "上传视频",
		"uploader"        : "{:U('Material/uploadweixin',array('type'=>'video','session_id'=>session_id()))}",
		"width"           : 100,
		'removeTimeout'	  : 1,
		'fileTypeExts'	  : '*.mp4; *.flv; *.avi;',
		"onUploadSuccess" : uploadPicture,
		'onFallback' : function() {
			alert('未检测到兼容版本的Flash.');
		}
	});
		$("[data-toggle='tab']").click(function(){
			$("#msgtype").val($(this).attr('data-msgtype'));
		});
		$('#is_to_all').change(function(){
			if($("#is_to_all option:selected").val()=="true"){
				$('#group_id').hide();
			}else{
				$('#group_id').show();
			}
		});
		highlight_subnav('{:U('Reply/group')}');
	});
</script>
</block>
